<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Learning Dashboard | T&P AI</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --dark-blue:#0a3d91;
            --royal-blue:#0a66c2;
            --success:#28a745;
            --bg:#f4f6fa;
            --white:#fff;
            --text:#333;
            --shadow:0 10px 30px rgba(0,0,0,0.08);
        }
        *{margin:0;padding:0;box-sizing:border-box;font-family: 'Segoe UI', sans-serif;}
        body{background:var(--bg);display:flex;min-height:100vh;color:var(--text);}

        /* SIDEBAR */
        .sidebar{ width:260px; background:var(--dark-blue); color:#fff; padding:30px 20px; position:fixed; height:100vh; z-index: 100;}
        .sidebar h2{margin-bottom:30px; display: flex; align-items: center; gap: 10px;}
        .sidebar ul{list-style:none;}
        .sidebar li{
            padding:14px; border-radius:8px; margin-bottom:10px; cursor:pointer;
            display: flex; align-items: center; gap: 12px; transition: 0.3s;
        }
        .sidebar li:hover, .sidebar li.active{background:var(--royal-blue); transform: translateX(5px);}

        /* MAIN */
        .main{margin-left:260px; padding:40px; width:calc(100% - 260px);}
        .header{margin-bottom:30px;}
        .tabs{display:flex; gap:12px; margin-bottom:30px; flex-wrap:wrap;}
        .tab-btn{
            padding:10px 25px; border:none; border-radius:25px; cursor:pointer;
            background:#fff; box-shadow:var(--shadow); font-weight:600; transition: 0.3s;
        }
        .tab-btn.active{background:var(--royal-blue); color:#fff;}

        .dashboard-grid{ display:grid; grid-template-columns:350px 1fr; gap:30px;}

        /* CHART & STATS */
        .chart-card{
            background:#fff; padding:30px; border-radius:20px; box-shadow:var(--shadow);
            text-align:center; height: fit-content;
        }
        .stats-box {
            margin-top: 20px; padding-top: 20px; border-top: 1px solid #eee;
        }
        .count-text { font-size: 24px; font-weight: 800; color: var(--royal-blue); }

        /* VIDEOS */
        .video-container{ display:grid; grid-template-columns:repeat(auto-fill,minmax(280px,1fr)); gap:25px;}
        .video-card{
            background:#fff; border-radius:15px; overflow:hidden;
            box-shadow:var(--shadow); transition:.3s; border: 2px solid transparent;
        }
        .video-card.completed{border-color: var(--success);}
        .video-card:hover{transform:translateY(-8px);}

        .thumbnail{height:160px; cursor:pointer; position:relative;}
        .thumbnail img{width:100%; height:100%; object-fit:cover;}
        .play-overlay{
            position:absolute; inset:0; background:rgba(0,0,0,0.3);
            display:flex; align-items:center; justify-content:center; opacity:0; transition:0.3s;
        }
        .thumbnail:hover .play-overlay{opacity:1;}
        .play-overlay i{font-size:50px; color:#fff;}

        .video-info{padding:18px;}
        .video-info h4{color:var(--dark-blue); font-size:16px; margin-bottom:5px; height: 40px; overflow: hidden;}
        .video-info p{font-size:13px; color:#777; margin-bottom:15px;}

        .status-bar{ display:flex; justify-content:space-between; align-items:center; }
        .check-btn{
            border:1px solid var(--royal-blue); padding:7px 15px; border-radius:20px;
            cursor:pointer; font-size:12px; font-weight:700; background: transparent; color: var(--royal-blue);
        }
        .completed .check-btn{background:var(--success); color:white; border-color: var(--success);}

        /* MODAL */
        .modal{
            display:none; position:fixed; inset:0; background:rgba(0,0,0,.9);
            justify-content:center; align-items:center; z-index: 1000;
        }
        .modal-content { position: relative; width: 90%; max-width: 900px; }
        .modal iframe{ width:100%; aspect-ratio: 16/9; border-radius: 10px; }
        .close-modal{ color:white; font-size:35px; cursor:pointer; position:absolute; top:-40px; right:0; }

        @media(max-width:1100px){
            .dashboard-grid{grid-template-columns:1fr;}
            .sidebar{width: 80px;}
            .sidebar h2 span, .sidebar li span {display: none;}
            .main{margin-left: 80px; width: calc(100% - 80px);}
        }
    </style>
</head>
<body>

<div class="sidebar">
    <h2><i class="fa-solid fa-graduation-cap"></i> <span>T&P AI</span></h2>
    <ul>
        <li class="active"><i class="fa-solid fa-house"></i> <span>Dashboard</span></li>
        <li onclick="window.location.reload()"><i class="fa-solid fa-book"></i> <span>Tutorials</span></li>
        <li><i class="fa-solid fa-file-invoice"></i> <span>Resume AI</span></li>
        <li onclick="alert('Redirecting to Mock Interview...')"><i class="fa-solid fa-headset"></i> <span>Mock Interview</span></li>
    </ul>
</div>

<div class="main">
    <div class="header">
        <h1>Video Learning Hub</h1>
        <p>Master your skills with branch-specific curated content</p>
    </div>

    <div class="tabs">
        <button class="tab-btn active" onclick="filterVideos('CSE',this)">Computer Science</button>
        <button class="tab-btn" onclick="filterVideos('ENTC',this)">E&TC</button>
        <button class="tab-btn" onclick="filterVideos('MECH',this)">Mechanical</button>
        <button class="tab-btn" onclick="filterVideos('APT',this)">Aptitude & Logic</button>
    </div>

    <div class="dashboard-grid">
        <div class="chart-card">
            <h3>Overall Progress</h3>
            <div style="position:relative; margin: 20px 0;">
                <canvas id="progressChart"></canvas>
            </div>
            <div class="stats-box">
                <p class="count-text" id="lectureCount">0 / 0</p>
                <p style="color:#666; font-size:14px">Lectures Completed</p>
                <p id="progressPercent" style="margin-top:10px; font-weight:bold; color:var(--success)">0%</p>
            </div>
        </div>

        <div class="video-container" id="videoGrid"></div>
    </div>
</div>

<div class="modal" id="videoModal">
    <div class="modal-content">
        <span class="close-modal" onclick="closeModal()">&times;</span>
        <iframe id="videoFrame" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>
    </div>
</div>

<script>
const videos = [
    // CSE
    {id:'c1', branch:'CSE', title:'Complete DSA Roadmap 2025', author:'Love Babbar', thumb:'https://img.youtube.com/vi/zm8_Fi6YXyY/mqdefault.jpg', link:'https://www.youtube.com/embed/zm8_Fi6YXyY'},
    {id:'c2', branch:'CSE', title:'Web Development Masterclass', author:'CodeWithHarry', thumb:'https://img.youtube.com/vi/6mbwJ2xhgzM/mqdefault.jpg', link:'https://www.youtube.com/embed/6mbwJ2xhgzM'},
    {id:'c3', branch:'CSE', title:'Operating Systems in 1 Video', author:'Gate Smashers', thumb:'https://img.youtube.com/vi/bkSWJJZNgfM/mqdefault.jpg', link:'https://www.youtube.com/embed/bkSWJJZNgfM'},
    // ENTC
    {id:'e1', branch:'ENTC', title:'Microprocessors Basics', author:'Paul McWhorter', thumb:'https://img.youtube.com/vi/30ZReG1X64g/mqdefault.jpg', link:'https://www.youtube.com/embed/30ZReG1X64g'},
    {id:'e2', branch:'ENTC', title:'Signal & Systems Prep', author:'Neso Academy', thumb:'https://img.youtube.com/vi/OatfS_V-z6M/mqdefault.jpg', link:'https://www.youtube.com/embed/OatfS_V-z6M'},
    // MECH
    {id:'m1', branch:'MECH', title:'Thermodynamics Concept', author:'The Engineering Mindset', thumb:'https://img.youtube.com/vi/8N1BxHgsoOw/mqdefault.jpg', link:'https://www.youtube.com/embed/8N1BxHgsoOw'},
    {id:'m2', branch:'MECH', title:'AutoCAD 3D Modeling', author:'SourceCAD', thumb:'https://img.youtube.com/vi/vS88L_z3y9A/mqdefault.jpg', link:'https://www.youtube.com/embed/vS88L_z3y9A'},
    // APTITUDE
    {id:'a1', branch:'APT', title:'Time & Work - Short Tricks', author:'Feel Free to Learn', thumb:'https://img.youtube.com/vi/KE7tQf9spPg/mqdefault.jpg', link:'https://www.youtube.com/embed/KE7tQf9spPg'},
    {id:'a2', branch:'APT', title:'Probability Concepts', author:'Magnet Brains', thumb:'https://img.youtube.com/vi/uY_mY-oM4Sg/mqdefault.jpg', link:'https://www.youtube.com/embed/uY_mY-oM4Sg'},
    {id:'a3', branch:'APT', title:'Logical Reasoning Tricks', author:'Adda247', thumb:'https://img.youtube.com/vi/V8RCO7Gv_9M/mqdefault.jpg', link:'https://www.youtube.com/embed/V8RCO7Gv_9M'}
];

let currentBranch = 'CSE';
let chartInstance;

const getDoneIds = () => new Set(JSON.parse(localStorage.getItem('v_done') || '[]'));
const saveDoneIds = (set) => localStorage.setItem('v_done', JSON.stringify([...set]));

function filterVideos(branch, btn) {
    currentBranch = branch;
    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');

    const grid = document.getElementById('videoGrid');
    grid.innerHTML = '';
    const doneIds = getDoneIds();

    videos.filter(v => v.branch === branch).forEach(v => {
        const isDone = doneIds.has(v.id);
        const card = document.createElement('div');
        card.className = `video-card ${isDone ? 'completed' : ''}`;
        card.innerHTML = `
            <div class="thumbnail" onclick="playVideo('${v.link}')">
                <img src="${v.thumb}">
                <div class="play-overlay"><i class="fa-solid fa-circle-play"></i></div>
            </div>
            <div class="video-info">
                <h4>${v.title}</h4>
                <p><i class="fa-solid fa-user"></i> ${v.author}</p>
                <div class="status-bar">
                    <span style="font-size:12px; color:${isDone?'#28a745':'#888'}">
                        ${isDone ? '<i class="fa-solid fa-circle-check"></i> Completed' : 'Status: Pending'}
                    </span>
                    <button class="check-btn" onclick="toggleStatus('${v.id}', this)">
                        ${isDone ? 'Done' : 'Mark Done'}
                    </button>
                </div>
            </div>`;
        grid.appendChild(card);
    });
    updateChart();
}

function toggleStatus(id, btn) {
    const doneIds = getDoneIds();
    const card = btn.closest('.video-card');
    
    if (doneIds.has(id)) {
        doneIds.delete(id);
        card.classList.remove('completed');
        btn.textContent = 'Mark Done';
    } else {
        doneIds.add(id);
        card.classList.add('completed');
        btn.textContent = 'Done';
    }
    saveDoneIds(doneIds);
    updateChart();
    
    // Refresh the status text locally without re-rendering everything
    const statusText = card.querySelector('.status-bar span');
    statusText.innerHTML = doneIds.has(id) ? 
        '<i class="fa-solid fa-circle-check"></i> Completed' : 'Status: Pending';
    statusText.style.color = doneIds.has(id) ? '#28a745' : '#888';
}

function updateChart() {
    const branchVideos = videos.filter(v => v.branch === currentBranch);
    const doneIds = getDoneIds();
    const completedCount = branchVideos.filter(v => doneIds.has(v.id)).length;
    const total = branchVideos.length;
    const percent = Math.round((completedCount / total) * 100) || 0;

    document.getElementById('lectureCount').textContent = `${completedCount} / ${total}`;
    document.getElementById('progressPercent').textContent = `${percent}% Completed`;

    if (chartInstance) chartInstance.destroy();
    const ctx = document.getElementById('progressChart').getContext('2d');
    chartInstance = new Chart(ctx, {
        type: 'doughnut',
        data: {
            datasets: [{
                data: [completedCount, total - completedCount],
                backgroundColor: ['#28a745', '#e9ecef'],
                borderWidth: 0
            }]
        },
        options: { cutout: '80%', plugins: { tooltip: { enabled: false } } }
    });
}

function playVideo(link) {
    document.getElementById('videoModal').style.display = 'flex';
    document.getElementById('videoFrame').src = link + "?autoplay=1";
}

function closeModal() {
    document.getElementById('videoModal').style.display = 'none';
    document.getElementById('videoFrame').src = "";
}

// Initialize
filterVideos('CSE', document.querySelector('.tab-btn'));
</script>
</body>
</html>